<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Examen de Conocimiento</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="lib/css/examenPsico.css" />
</head>
<body>
  <div class="main-layout">
    <!-- Header -->
    <header class="main-header">
      <a href="perfilCandidato.html" class="header-left">
        <img src="lib/img/logo.jpg" alt="Logo" />
        <span class="title">TalentCheck</span>
      </a>
      <div class="header-right">
        <!-- Botón cerrar sesión -->
        <img src="https://cdn-icons-png.flaticon.com/512/4128/4128170.png" alt="Usuario" class="user-avatar" id="logoutBtn" title="Cerrar sesión" />
      </div>
    </header>

    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="nav">
          <a href="perfilCandidato.html"><button class="nav-btn"><i class="fas fa-home"></i></button></a>
          <a href="modificar.html"><button class="nav-btn"><i class="fas fa-edit"></i></button></a>
          <a href="proceso.html"><button class="nav-btn"><i class="fas fa-spinner fa-spin"></i></button></a>
          <a href="examenCono.html"><button class="nav-btn"><i class="fas fa-clipboard-list"></i></button></a>
          <a href="examenPsico.html"><button class="nav-btn"><i class="fas fa-brain"></i></button></a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="exam-content">
        <!-- Video siempre visible -->
        <div id="video-container">
          <video id="video" width="100" height="80" autoplay muted></video>
        </div>

        <!-- Intro -->
            <section class="intro-section" id="intro">
            <div class="robot-box">
                <img src="data:image/png;base64,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" class="robot-img" alt="Robot">
            </div>
            <h2>Examen Psicométrico</h2>
            <button class="camera-btn" id="camara" onclick="activarCamara()"><i class="fas fa-video"></i> Encender cámara</button>
            <button class="start-btn" id="startBtn" onclick="startEvaluation()" disabled>Iniciar evaluación</button>
            <p class="camera-warning">* Debes permitir el acceso a la cámara para comenzar el examen.</p>
            </section>

            <!-- Paso 1 -->
            <section class="question-section" id="step-1" style="display:none;">
            <div class="question">
                <p><strong>¿Con qué frecuencia te sientes motivado para enfrentar nuevos desafíos?</strong></p>
                <label><input type="radio" name="motivacion"> Siempre</label>
                <label><input type="radio" name="motivacion"> Frecuentemente</label>
                <label><input type="radio" name="motivacion"> Algunas veces</label>
                <label><input type="radio" name="motivacion"> Rara vez</label>
            </div>
            <div class="question">
                <p><strong>Cuando tienes muchos problemas, ¿cómo reaccionas?</strong></p>
                <label><input type="radio" name="reaccion"> Me bloqueo emocionalmente</label>
                <label><input type="radio" name="reaccion"> Me estreso pero actúo</label>
                <label><input type="radio" name="reaccion"> Organizo soluciones</label>
                <label><input type="radio" name="reaccion"> Busco apoyo de otros</label>
            </div>
            <button class="next-btn" onclick="nextStep(1)">Siguiente</button>
            </section>

            <!-- Paso 2 -->
            <section class="question-section" id="step-2" style="display:none;">
            <div class="question">
                <p><strong>¿Qué harías si tienes una tarea con tiempo limitado?</strong></p>
                <label><input type="radio" name="tarea"> La pospongo hasta último momento</label>
                <label><input type="radio" name="tarea"> Me organizo y la hago pronto</label>
                <label><input type="radio" name="tarea"> Me estreso y no la termino</label>
                <label><input type="radio" name="tarea"> Delego si puedo</label>
            </div>
            <div class="question">
                <p><strong>¿Cómo reaccionas ante una crítica negativa?</strong></p>
                <label><input type="radio" name="critica"> Me afecta emocionalmente</label>
                <label><input type="radio" name="critica"> Escucho y reflexiono</label>
                <label><input type="radio" name="critica"> Ignoro a quien me critica</label>
                <label><input type="radio" name="critica"> Me enojo y reacciono</label>
            </div>
            <div class="question">
                <p><strong>¿Qué prefieres al trabajar?</strong></p>
                <label><input type="radio" name="trabajo"> Trabajo individual</label>
                <label><input type="radio" name="trabajo"> Trabajo en equipo</label>
                <label><input type="radio" name="trabajo"> Un balance de ambos</label>
                <label><input type="radio" name="trabajo"> Depende del proyecto</label>
            </div>
            <button class="next-btn" onclick="nextStep(2)">Siguiente</button>
            </section>

            <!-- Paso 3 -->
            <section class="question-section" id="step-3" style="display:none;">
            <div class="question">
                <p><strong>¿Cómo defines tu nivel de tolerancia a la frustración?</strong></p>
                <label><input type="radio" name="frustracion"> Muy bajo</label>
                <label><input type="radio" name="frustracion"> Moderado</label>
                <label><input type="radio" name="frustracion"> Alto</label>
                <label><input type="radio" name="frustracion"> Depende del contexto</label>
            </div>
            <div class="question">
                <p><strong>¿Qué tan fácilmente te adaptas a los cambios?</strong></p>
                <label><input type="radio" name="cambios"> Muy fácilmente</label>
                <label><input type="radio" name="cambios"> Con algo de dificultad</label>
                <label><input type="radio" name="cambios"> Me cuesta adaptarme</label>
                <label><input type="radio" name="cambios"> Evito los cambios</label>
            </div>
            <button class="submit-btn" onclick="finalizarExamen()">Enviar evaluación</button>
            </section>

 <!-- Mensaje final -->
        <section class="question-section" id="final-msg" style="display:none;">
          <h2>¡Gracias por completar tu examen!</h2>
          <p>Está al pendiente de tu puntuación y si pasaste a la siguiente etapa.</p>
        </section>

      </main>
    </div>
  </div>

  <script>

    let streamGlobal = null; // Guardamos el stream para poder detenerlo después

    function activarCamara() {
      const video = document.getElementById('video');
      const startBtn = document.getElementById('startBtn');
      navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
          streamGlobal = stream; // guardamos el stream
          video.srcObject = stream;
          startBtn.disabled = false;
        })
        .catch((err) => {
          alert("⚠️ Debes permitir acceso a la cámara para continuar.");
          startBtn.disabled = true;
        });
    }

    function startEvaluation() {
      document.getElementById('intro').style.display = 'none';
      document.getElementById('step-1').style.display = 'block';
    }

    function nextStep(num) {
      document.getElementById(`step-${num}`).style.display = 'none';
      document.getElementById(`step-${num + 1}`).style.display = 'block';
    }

    function finalizarExamen() {
      // Ocultar paso 3 y mostrar mensaje final
      document.getElementById('step-3').style.display = 'none';
      document.getElementById('final-msg').style.display = 'block';

      // Detener el stream de la cámara si existe
      if (streamGlobal) {
        streamGlobal.getTracks().forEach(track => track.stop());
        streamGlobal = null;
      }

      // Ocultar el contenedor del video para que desaparezca el recuadro
      const videoContainer = document.getElementById('video-container');
      if (videoContainer) {
        videoContainer.style.display = 'none';
      }
    }
  </script>
  
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
  import {
    getAuth,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut
  } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';

  const firebaseConfig = {
    apiKey: "AIzaSyC_I3bIIk0nfGvuDSK0nZ_JcI7ywTP_Rd8",
    authDomain: "talentchek-t.firebaseapp.com",
    projectId: "talentchek-t",
    storageBucket: "talentchek-t.appspot.com",
    messagingSenderId: "546382065526",
    appId: "1:546382065526:web:249deb0e90ff9b358bd457",
    measurementId: "G-WCG5D1N4ZJ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('loginForm');
    const logoutBtn = document.getElementById('logoutBtn');

    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');

        // Evita error si no existen los elementos
        if (!emailInput || !passwordInput) {
          alert("No se encontró el input de email o password.");
          return;
        }

        const email = emailInput.value.trim();
        const password = passwordInput.value;

        if (!email || !password) {
          alert("Por favor completa todos los campos.");
          return;
        }

        try {
          const { user } = await signInWithEmailAndPassword(auth, email, password);
          if (user.email.toLowerCase() === 'reclutador@gmail.com') {
            alert("Bienvenido, Reclutador.");
            window.location.href = "perfilReclutador.html";
          } else {
            alert("Inicio de sesión exitoso.");
            window.location.href = "perfilCandidato.html";
          }
        } catch (error) {
          switch (error.code) {
            case 'auth/invalid-email':
              alert('El correo no es válido');
              break;
            case 'auth/user-disabled':
              alert('El usuario ha sido deshabilitado');
              break;
            case 'auth/user-not-found':
              alert('El usuario no existe');
              break;
            case 'auth/wrong-password':
              alert('Contraseña incorrecta');
              break;
            default:
              alert('Error al iniciar sesión: ' + error.message);
          }
        }
      });
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', async () => {
        try {
          await signOut(auth);
          alert("Sesión cerrada correctamente.");
          window.location.href = "index.html";
        } catch (error) {
          alert("Error al cerrar sesión: " + error.message);
        }
      });
    }

    onAuthStateChanged(auth, user => {
      if (user) {
        console.log("Usuario activo:", user.email);
      } else {
        console.log("No hay usuario logueado");
      }
    });
  });
</script>
</body>
</html>
